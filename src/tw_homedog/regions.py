"""Taiwan region and district codes for 591 real estate site."""


# =============================================================================
# Region codes (all 22 counties/cities)
# =============================================================================

REGION_CODES: dict[str, int] = {
    "台北市": 1,
    "新北市": 3,
    "桃園市": 6,
    "新竹市": 4,
    "新竹縣": 5,
    "苗栗縣": 21,
    "台中市": 8,
    "彰化縣": 10,
    "南投縣": 11,
    "雲林縣": 12,
    "嘉義市": 13,
    "嘉義縣": 14,
    "台南市": 15,
    "高雄市": 17,
    "屏東縣": 19,
    "宜蘭縣": 22,
    "花蓮縣": 23,
    "台東縣": 24,
    "澎湖縣": 25,
    "金門縣": 26,
    "連江縣": 27,
    "基隆市": 2,
}


# =============================================================================
# Buy mode section (district) codes per region
# Source: 591 BFF API section parameter
# =============================================================================

BUY_SECTION_CODES: dict[int, dict[str, int]] = {
    # 台北市 (region=1)
    1: {
        "中正區": 1, "大同區": 2, "中山區": 3, "松山區": 4,
        "大安區": 5, "萬華區": 6, "信義區": 7, "士林區": 8,
        "北投區": 9, "內湖區": 10, "南港區": 11, "文山區": 12,
    },
    # 新北市 (region=3)
    3: {
        "板橋區": 26, "三重區": 27, "中和區": 28, "永和區": 29,
        "新莊區": 30, "新店區": 31, "土城區": 32, "蘆洲區": 33,
        "樹林區": 34, "汐止區": 35, "鶯歌區": 36, "三峽區": 37,
        "淡水區": 38, "瑞芳區": 39, "五股區": 40, "泰山區": 41,
        "林口區": 42, "深坑區": 43, "石碇區": 44, "坪林區": 45,
        "三芝區": 46, "石門區": 47, "八里區": 48, "平溪區": 49,
        "雙溪區": 50, "貢寮區": 51, "金山區": 52, "萬里區": 53,
        "烏來區": 54,
    },
    # 基隆市 (region=2)
    2: {
        "仁愛區": 13, "信義區": 14, "中正區": 15, "中山區": 16,
        "安樂區": 17, "暖暖區": 18, "七堵區": 19,
    },
    # 桃園市 (region=6)
    6: {
        "桃園區": 55, "中壢區": 56, "大溪區": 57, "楊梅區": 58,
        "蘆竹區": 59, "大園區": 60, "龜山區": 61, "八德區": 62,
        "龍潭區": 63, "平鎮區": 64, "新屋區": 65, "觀音區": 66,
        "復興區": 67,
    },
    # 新竹市 (region=4)
    4: {
        "東區": 20, "北區": 21, "香山區": 22,
    },
    # 新竹縣 (region=5)
    5: {
        "竹北市": 23, "竹東鎮": 24, "新埔鎮": 25,
        "關西鎮": 68, "湖口鄉": 69, "新豐鄉": 70,
        "芎林鄉": 71, "橫山鄉": 72, "北埔鄉": 73,
        "寶山鄉": 74, "峨眉鄉": 75, "尖石鄉": 76,
        "五峰鄉": 77,
    },
    # 苗栗縣 (region=21)
    21: {
        "苗栗市": 248, "苑裡鎮": 249, "通霄鎮": 250,
        "竹南鎮": 251, "頭份市": 252, "後龍鎮": 253,
        "卓蘭鎮": 254, "大湖鄉": 255, "公館鄉": 256,
        "銅鑼鄉": 257, "南庄鄉": 258, "頭屋鄉": 259,
        "三義鄉": 260, "西湖鄉": 261, "造橋鄉": 262,
        "三灣鄉": 263, "獅潭鄉": 264, "泰安鄉": 265,
    },
    # 台中市 (region=8)
    8: {
        "中區": 78, "東區": 79, "南區": 80, "西區": 81,
        "北區": 82, "北屯區": 83, "西屯區": 84, "南屯區": 85,
        "太平區": 86, "大里區": 87, "霧峰區": 88, "烏日區": 89,
        "豐原區": 90, "后里區": 91, "石岡區": 92, "東勢區": 93,
        "和平區": 94, "新社區": 95, "潭子區": 96, "大雅區": 97,
        "神岡區": 98, "大肚區": 99, "沙鹿區": 100, "龍井區": 101,
        "梧棲區": 102, "清水區": 103, "大甲區": 104, "外埔區": 105,
        "大安區": 106,
    },
    # 彰化縣 (region=10)
    10: {
        "彰化市": 115, "鹿港鎮": 116, "和美鎮": 117,
        "線西鄉": 118, "伸港鄉": 119, "福興鄉": 120,
        "秀水鄉": 121, "花壇鄉": 122, "芬園鄉": 123,
        "員林市": 124, "溪湖鎮": 125, "田中鎮": 126,
        "大村鄉": 127, "埔鹽鄉": 128, "埔心鄉": 129,
        "永靖鄉": 130, "社頭鄉": 131, "二水鄉": 132,
        "北斗鎮": 133, "二林鎮": 134, "田尾鄉": 135,
        "埤頭鄉": 136, "芳苑鄉": 137, "大城鄉": 138,
        "竹塘鄉": 139, "溪州鄉": 140,
    },
    # 南投縣 (region=11)
    11: {
        "南投市": 141, "埔里鎮": 142, "草屯鎮": 143,
        "竹山鎮": 144, "集集鎮": 145, "名間鄉": 146,
        "鹿谷鄉": 147, "中寮鄉": 148, "魚池鄉": 149,
        "國姓鄉": 150, "水里鄉": 151, "信義鄉": 152,
        "仁愛鄉": 153,
    },
    # 雲林縣 (region=12)
    12: {
        "斗六市": 154, "斗南鎮": 155, "虎尾鎮": 156,
        "西螺鎮": 157, "土庫鎮": 158, "北港鎮": 159,
        "古坑鄉": 160, "大埤鄉": 161, "莿桐鄉": 162,
        "林內鄉": 163, "二崙鄉": 164, "崙背鄉": 165,
        "麥寮鄉": 166, "東勢鄉": 167, "褒忠鄉": 168,
        "台西鄉": 169, "元長鄉": 170, "四湖鄉": 171,
        "口湖鄉": 172, "水林鄉": 173,
    },
    # 嘉義市 (region=13)
    13: {
        "東區": 174, "西區": 175,
    },
    # 嘉義縣 (region=14)
    14: {
        "朴子市": 176, "布袋鎮": 177, "大林鎮": 178,
        "民雄鄉": 179, "溪口鄉": 180, "新港鄉": 181,
        "六腳鄉": 182, "東石鄉": 183, "義竹鄉": 184,
        "鹿草鄉": 185, "太保市": 186, "水上鄉": 187,
        "中埔鄉": 188, "竹崎鄉": 189, "梅山鄉": 190,
        "番路鄉": 191, "大埔鄉": 192, "阿里山鄉": 193,
    },
    # 台南市 (region=15)
    15: {
        "中西區": 194, "東區": 195, "南區": 196, "北區": 197,
        "安平區": 198, "安南區": 199, "永康區": 200, "歸仁區": 201,
        "新化區": 202, "左鎮區": 203, "玉井區": 204, "楠西區": 205,
        "南化區": 206, "仁德區": 207, "關廟區": 208, "龍崎區": 209,
        "官田區": 210, "麻豆區": 211, "佳里區": 212, "西港區": 213,
        "七股區": 214, "將軍區": 215, "學甲區": 216, "北門區": 217,
        "新營區": 218, "後壁區": 219, "白河區": 220, "東山區": 221,
        "六甲區": 222, "下營區": 223, "柳營區": 224, "鹽水區": 225,
        "善化區": 226, "大內區": 227, "山上區": 228, "新市區": 229,
        "安定區": 230,
    },
    # 高雄市 (region=17)
    17: {
        "楠梓區": 266, "左營區": 267, "鼓山區": 268, "三民區": 269,
        "鹽埕區": 270, "前金區": 271, "新興區": 272, "苓雅區": 273,
        "前鎮區": 274, "旗津區": 275, "小港區": 276, "鳳山區": 277,
        "大寮區": 278, "鳥松區": 279, "林園區": 280, "仁武區": 281,
        "大樹區": 282, "大社區": 283, "岡山區": 284, "路竹區": 285,
        "橋頭區": 286, "梓官區": 287, "彌陀區": 288, "永安區": 289,
        "湖內區": 290, "茄萣區": 291, "阿蓮區": 292, "田寮區": 293,
        "燕巢區": 294, "旗山區": 295, "美濃區": 296, "內門區": 297,
        "杉林區": 298, "甲仙區": 299, "六龜區": 300, "茂林區": 301,
        "桃源區": 302, "那瑪夏區": 303,
    },
    # 屏東縣 (region=19)
    19: {
        "屏東市": 304, "潮州鎮": 305, "東港鎮": 306,
        "恆春鎮": 307, "萬丹鄉": 308, "長治鄉": 309,
        "麟洛鄉": 310, "九如鄉": 311, "里港鄉": 312,
        "鹽埔鄉": 313, "高樹鄉": 314, "萬巒鄉": 315,
        "內埔鄉": 316, "竹田鄉": 317, "新埤鄉": 318,
        "枋寮鄉": 319, "新園鄉": 320, "崁頂鄉": 321,
        "林邊鄉": 322, "南州鄉": 323, "佳冬鄉": 324,
        "琉球鄉": 325, "車城鄉": 326, "滿州鄉": 327,
        "枋山鄉": 328, "霧台鄉": 329, "瑪家鄉": 330,
        "泰武鄉": 331, "來義鄉": 332, "春日鄉": 333,
        "獅子鄉": 334, "牡丹鄉": 335, "三地門鄉": 336,
    },
    # 宜蘭縣 (region=22)
    22: {
        "宜蘭市": 337, "羅東鎮": 338, "蘇澳鎮": 339,
        "頭城鎮": 340, "礁溪鄉": 341, "壯圍鄉": 342,
        "員山鄉": 343, "冬山鄉": 344, "五結鄉": 345,
        "三星鄉": 346, "大同鄉": 347, "南澳鄉": 348,
    },
    # 花蓮縣 (region=23)
    23: {
        "花蓮市": 349, "鳳林鎮": 350, "玉里鎮": 351,
        "新城鄉": 352, "吉安鄉": 353, "壽豐鄉": 354,
        "光復鄉": 355, "豐濱鄉": 356, "瑞穗鄉": 357,
        "富里鄉": 358, "秀林鄉": 359, "萬榮鄉": 360,
        "卓溪鄉": 361,
    },
    # 台東縣 (region=24)
    24: {
        "台東市": 362, "成功鎮": 363, "關山鎮": 364,
        "卑南鄉": 365, "鹿野鄉": 366, "池上鄉": 367,
        "東河鄉": 368, "長濱鄉": 369, "太麻里鄉": 370,
        "大武鄉": 371, "綠島鄉": 372, "海端鄉": 373,
        "延平鄉": 374, "金峰鄉": 375, "達仁鄉": 376,
        "蘭嶼鄉": 377,
    },
    # 澎湖縣 (region=25)
    25: {
        "馬公市": 378, "湖西鄉": 379, "白沙鄉": 380,
        "西嶼鄉": 381, "望安鄉": 382, "七美鄉": 383,
    },
    # 金門縣 (region=26)
    26: {
        "金城鎮": 384, "金湖鎮": 385, "金沙鎮": 386,
        "金寧鄉": 387, "烈嶼鄉": 388, "烏坵鄉": 389,
    },
    # 連江縣 (region=27)
    27: {
        "南竿鄉": 390, "北竿鄉": 391, "莒光鄉": 392,
        "東引鄉": 393,
    },
}


# =============================================================================
# Rent mode section codes (Taipei only - verified)
# Note: Rent mode uses different codes from buy mode.
# Only Taipei codes are verified; other regions are out of scope.
# =============================================================================

RENT_SECTION_CODES: dict[int, dict[str, int]] = {
    1: {
        "中正區": 8, "大同區": 12, "中山區": 1, "松山區": 4,
        "大安區": 7, "萬華區": 9, "信義區": 3, "士林區": 10,
        "北投區": 11, "內湖區": 5, "南港區": 6, "文山區": 2,
    },
}


# =============================================================================
# English to Chinese district name mapping (Taipei only, backward compat)
# =============================================================================

EN_TO_ZH: dict[str, str] = {
    "Zhongzheng": "中正區",
    "Datong": "大同區",
    "Zhongshan": "中山區",
    "Songshan": "松山區",
    "Daan": "大安區",
    "Wanhua": "萬華區",
    "Xinyi": "信義區",
    "Shilin": "士林區",
    "Beitou": "北投區",
    "Neihu": "內湖區",
    "Nangang": "南港區",
    "Wenshan": "文山區",
}


# =============================================================================
# Helper functions
# =============================================================================

def resolve_region(value: int | str) -> int:
    """Resolve a region value to its numeric code.

    Accepts:
      - int: returned as-is
      - str (Chinese name): looked up in REGION_CODES
    """
    if isinstance(value, int):
        return value
    if isinstance(value, str):
        code = REGION_CODES.get(value)
        if code is not None:
            return code
        raise ValueError(
            f"Unknown region: '{value}'. "
            f"Valid regions: {', '.join(REGION_CODES.keys())}"
        )
    raise TypeError(f"region must be int or str, got {type(value).__name__}")


def resolve_districts(
    region_id: int,
    names: list[str],
    mode: str = "buy",
) -> dict[str, int]:
    """Resolve district names to their section codes.

    Returns {name: code} for all valid names.
    Supports Chinese names directly and English names (auto-converted via EN_TO_ZH).
    """
    if mode == "buy":
        section_map = BUY_SECTION_CODES.get(region_id, {})
    else:
        section_map = RENT_SECTION_CODES.get(region_id, {})

    result = {}
    for name in names:
        # Try direct lookup (Chinese name)
        if name in section_map:
            result[name] = section_map[name]
            continue
        # Try English→Chinese conversion (backward compat)
        zh_name = EN_TO_ZH.get(name)
        if zh_name and zh_name in section_map:
            result[zh_name] = section_map[zh_name]
            continue

    return result
